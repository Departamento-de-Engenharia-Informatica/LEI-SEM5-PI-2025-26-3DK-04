## 3. Design## 3. Design



### 3.1. System Sequence Diagram (SSD)This document describes the design for US_2.2.1 — Create and Update Vessel Types. It follows the project's existing design-doc style (SSD, responsibility assignment, sequence diagrams, SOLID and GoF patterns).



![SSD Create Vessel Type](sdUS2.2.1_create.svg)### 3.1. System Sequence Diagram (SSD)



![SSD Update Vessel Type](sdUS2.2.1_update.svg)



------



### 3.2. Interaction Responsibility Assignment### 3.2. Interaction Responsibility Assignment



| Interaction Step                                 | Question: Which class is responsible for…      | Class                         | Justification (with patterns)                                               || Interaction Step                                    | Question: Which class is responsible for…        | Class / Component                | Justification (pattern)                                                   |

|--------------------------------------------------|------------------------------------------------|-------------------------------|----------------------------------------------------------------------------||-----------------------------------------------------|-------------------------------------------------|----------------------------------|---------------------------------------------------------------------------|

| Step 1: Officer requests to create a vessel type | Handling user input and triggering the process | `VesselTypesController`       | **Controller:** Coordinates actions and delegates to application services. || Step 1: Officer requests to create a vessel type     | Handling user input and routing to application  | `VesselTypesController` (API)    | Controller: coordinates request validation and service calls.            |

| Step 2: Validate and process business logic      | Validating input and executing business rules  | `VesselTypeService`           | **Information Expert:** Centralizes the business logic.                    || Step 2: Validate DTO and map to domain              | Validating input and mapping to domain objects  | `VesselTypeService`              | Information Expert: centralizes business rules and validation.          |

| Step 3: Create/Update domain entity              | Managing vessel type data and validation       | `VesselType`                  | **Information Expert:** Domain entity holds relevant knowledge.            || Step 3: Build domain entity and enforce invariants   | Creating/Updating `VesselType`                  | `VesselType` (domain entity)     | Entity: encapsulates consistency rules and state.                        |

| Step 4: Persist data                             | Saving vessel type                             | `IVesselTypeRepository`       | **Repository Pattern:** Handles data persistence logic.                    || Step 4: Persist entity                               | Saving to database                              | `IVesselTypeRepository`          | Repository pattern: abstracts persistence and provides search ops.      |

| Step 5: Feedback to user                         | Showing success message                        | `VesselTypesController`       | **Controller:** Manages user interaction and result display.               || Step 5: Return result to caller                      | Formatting response / DTO                       | `VesselTypeDto` / Controller     | Pure Fabrication / Adapter: prepares response for the API.              |



------



### 3.3. Sequence Diagram### 3.3. API Contract (HTTP)



Notes: the project uses conventional REST controllers. The suggested endpoints:



### 3.4. SOLID Principles- POST /api/vesseltypes

	- Body: `CreatingVesselTypeDto` (Name, Description, Capacity, MaxRows, MaxBays, MaxTiers)

| Principle                                     | Application in US_2.2.1                                                                              | Explanation                                         |	- Response: 201 Created with `VesselTypeDto` on success, 400 Bad Request on validation failure, 401/403 for unauthorized.

|----------------------------------------------|------------------------------------------------------------------------------------------------------|-----------------------------------------------------|

| **S – Single Responsibility Principle (SRP)** | `VesselTypesController` handles only coordination of business logic.                                | Keeps UI, logic, and persistence separated.         |- PUT /api/vesseltypes/{id}

|                                              | `VesselTypeService` validates and processes business rules.                                         | Focused solely on vessel type management logic.     |	- Body: `UpdatingVesselTypeDto` (Name, Description, Capacity, MaxRows, MaxBays, MaxTiers)

|                                              | `VesselType` encapsulates domain logic.                                                             | Isolates business entities from infrastructure.     |	- Response: 200 OK with updated `VesselTypeDto`, 404 Not Found if id doesn't exist.

| **O – Open/Closed Principle (OCP)**           | Services and domain classes can be extended with new validations without changing existing logic.    | Allows extensibility with minimal modification.     |

| **L – Liskov Substitution Principle (LSP)**   | `IVesselTypeRepository` can be replaced by any implementation (e.g., SQL, in-memory).                | Promotes interchangeable components.                |- GET /api/vesseltypes?search={term}

| **I – Interface Segregation Principle (ISP)** | Interfaces like `IVesselTypeRepository` are focused on essential operations (`save`, `findById`).    | Prevents unnecessary dependencies.                  |	- Query: search by name or description

| **D – Dependency Inversion Principle (DIP)**  | The controller depends on abstractions (`IVesselTypeRepository`).                                    | Promotes decoupling and enables testing with mocks. |	- Response: 200 OK with list of `VesselTypeDto`



---DTOs (from codebase):

- `CreatingVesselTypeDto` — Name, Description, Capacity, MaxRows, MaxBays, MaxTiers

### 3.5. GoF Patterns- `UpdatingVesselTypeDto` — same fields as create DTO

- `VesselTypeDto` — fields returned by services (see `Domain/Vessels/VesselTypeDto.cs`)

| Pattern                          | Usage in US_2.2.1                                                                                    | Explanation                                       |

|----------------------------------|------------------------------------------------------------------------------------------------------|---------------------------------------------------|---

| **Controller**                   | `VesselTypesController` coordinates the flow between UI, domain, and persistence.                   | Acts as mediator between layers.                  |

| **Repository**                   | `IVesselTypeRepository` encapsulates persistence operations.                                         | Abstracts database access.                        |### 3.4. Sequence Diagram (Create)

| **Information Expert**           | `VesselType` contains its own validation logic.                                                      | Domain entity holds relevant knowledge.           |

| **Pure Fabrication**             | `VesselTypeService` exists for technical separation of concerns.                                     | Improves maintainability and testability.         |Sequence overview (textual):

| **Low Coupling / High Cohesion** | Clear separation between layers and well-defined responsibilities.                                   | Reduces interdependencies and increases cohesion. |1. Controller receives POST /api/vesseltypes with `CreatingVesselTypeDto`.

2. Controller calls `VesselTypeService.CreateAsync(dto)`.

---3. Service validates business rules:

	 - Name must be unique (repository query)
	 - Capacity and max dimensions must be positive integers
4. Service constructs `VesselType` domain object and calls `IVesselTypeRepository.AddAsync(entity)`.
5. UnitOfWork / repository persists and returns the saved entity.
6. Service returns `VesselTypeDto` to controller, which responds 201 Created.

Sequence Diagram (Update) is analogous with retrieving the entity by id, calling domain entity's Update method, then persisting.

---

### 3.5. Domain Model (class summary)

- `VesselType` (Domain)
	- Id: `VesselTypeId`
	- Name: string (unique)
	- Description: string
	- Capacity: int
	- MaxRows, MaxBays, MaxTiers: int
	- Behavior: validation on creation/update (non-null name, positive capacities/dimensions)

- `VesselTypeService`
	- Responsibilities: orchestrate create/update flows, validate uniqueness via `IVesselTypeRepository`, map DTOs to domain entities and to DTOs for responses.

- `IVesselTypeRepository`
	- Responsibilities: CRUD and search operations. Methods include `SearchByNameAsync`, `SearchByDescriptionAsync`, `SearchByNameOrDescriptionAsync` (see interface).

---

### 3.6. Business Rules & Validation

From Analysis (enforced here):
- Only authenticated users with role Port Authority Officer can create/update vessel types — enforce at controller (authorization attribute) and test.
- Each vessel type must have a unique identifier (generated) and a unique name — service must check repository for name existence before creating/updating.
- Capacity, max rows/bays/tiers must be > 0.
- Description may be non-unique per clarifications in requirements, but analysis earlier stated "descriptions must be unique" (conflict). Implementation choice: follow requirements clarifications — descriptions need NOT be unique. The service will only enforce uniqueness on Name. (Assumption documented.)

Edge cases:
- Attempt to create a vessel type with a name that already exists -> return 400 with validation error.
- Attempt to update non-existing id -> return 404.
- Partial/invalid numeric values (<=0) -> return 400.

---

### 3.7. Security and Authorization

- All create/update endpoints must be protected with authentication and an authorization policy/role check for "Port Authority Officer".
- Validate inputs server-side even if client-side validation exists.

---

### 3.8. SOLID Principles Applied

| Principle | Application |
|-----------|-------------|
| SRP       | `VesselTypeService` handles orchestration and business rules; controller handles HTTP concerns; repository handles persistence. |
| OCP       | Behavior can be extended via new services or decorators without changing existing classes. |
| LSP       | `IVesselTypeRepository` implementations are interchangeable (EF Core, in-memory tests). |
| ISP       | Interfaces are narrowly scoped (`IRepository` and `IVesselTypeRepository`). |
| DIP       | Controller and services depend on repository abstractions, injected via DI (see `Startup.cs`). |

---

### 3.9. Design Patterns (GoF / Architectural)

- Repository: `IVesselTypeRepository` abstracts persistence.
- Controller: web layer controllers coordinate requests and responses.
- Information Expert: `VesselType` holds its invariants.
- DTOs / Adapter: map domain objects to transport DTOs.

---

### 3.10. Testability

- Unit tests for `VesselTypeService` verifying:
	- Unique name enforcement (mock `IVesselTypeRepository`).
	- Validation of numeric fields.
	- Update flow for existing and non-existing ids.
- Integration tests for controller endpoints with in-memory DB or test database.

---

### 3.11. Implementation Notes & File References

- Domain classes and DTOs:
	- `Domain/Vessels/VesselType.cs`
	- `Domain/Vessels/VesselTypeId.cs`
	- `Domain/Vessels/VesselTypeDto.cs`
	- `Domain/Vessels/CreatingVesselTypeDto.cs`
	- `Domain/Vessels/UpdatingVesselTypeDto.cs`
- Service and repository:
	- `Domain/Vessels/VesselTypeService.cs`
	- `Domain/Vessels/IVesselTypeRepository.cs`
	- Repository implementation registered in `Startup.cs` (`VesselTypeRepository`)
- Controller:
	- Add a `VesselTypesController` (if not present) following existing controllers' style (e.g., `VesselsController.cs`).

Assumptions made:
- Descriptions are not required to be unique (followed requirements clarification). If project policy requires description uniqueness, change the service to enforce it.

---

### 3.12. Next steps

1. Implement (or verify) `VesselTypesController` endpoints and wire authorization attributes.
2. Implement unit tests for `VesselTypeService` (happy path + name-duplicate + invalid values).
3. Create PlantUML sequence and SSD diagrams under this folder (optional).

---

References: existing design docs in this repo for style: other `3.design.md` files under `docs/sprint1`.