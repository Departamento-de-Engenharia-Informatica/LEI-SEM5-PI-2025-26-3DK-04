# 4. User Story Implementation Report

---

## 4.1. US_2.2.10 â€“ View Status of Submitted Vessel Visit Notifications

### 4.2. Description

As a Shipping Agent Representative, I want to view the status of all my submitted Vessel Visit Notifications, so that I am always informed about the decisions of the Port Authority.

---

### 4.3. Implementation Details

- **User Interaction & Flow Control**  
  A search endpoint was developed to allow Shipping Agent Representatives to view and filter vessel visit notifications. Representatives can search by vessel, status, representative, organization, and time period.

- **Business Logic Coordination**  
  The `VesselVisitNotificationsController` manages the search operations. It handles query parameters, delegates filtering to the `VesselVisitNotificationService`, and ensures that business rules (such as organization-based access control) are enforced.

- **Domain Entity Enhancement**  
  The `VesselVisitNotification` entity was enhanced with `RepresentativeId` and `CreatedAt` properties to track who submitted each notification and when. This enables filtering by representative and time period.

- **Persistence**  
  The `IVesselVisitNotificationRepository` interface was extended with a `SearchNotificationsAsync` method that supports complex filtering. The implementation queries notifications based on all provided filters and enforces organization-based access control by joining with the Representative table.

- **Validation & Error Handling**  
  Input validation ensures that:
  - Status values are valid enum values (Pending, Approved, Rejected)
  - Date ranges are properly formatted
  - All filters are optional and can be combined
  - Invalid filter values trigger appropriate validation error messages

- **Authorization & Security**  
  Role-based access control ensures that only authenticated users with the "Shipping Agent Representative" role can search and view vessel visit notifications. Additionally, repository-level filtering ensures representatives can only see their own notifications or notifications from representatives within their organization.

- **Data Consistency**  
  Database persistence was switched from InMemory to SQLite to ensure notifications persist across application restarts. Entity Framework migrations were created to properly configure the new `RepresentativeId` and `CreatedAt` fields.

---
