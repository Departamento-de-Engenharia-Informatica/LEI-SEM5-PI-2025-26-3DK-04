# 4. User Story Implementation Report

---

## 4.1. US_2.2.2 â€“ Register and Update Vessel Records

### 4.2. Description

As a Port Authority Officer, I want to register and update vessel records, so that valid vessels can be referenced in visit notifications.

---

### 4.3. Implementation Details

- **User Interaction & Flow Control**  
  A UI was developed to allow Port Authority Officers to create and update vessel records by entering details such as IMO number, vessel name, vessel type, owner, and operator.

- **Business Logic Coordination**  
  The `VesselsController` manages the vessel registration and update process. It handles user input, delegates validation to the `VesselService`, and ensures that business rules (such as valid IMO format and existing vessel type references) are enforced before persistence.

- **Domain Entity Construction**  
  The `Vessel` entity encapsulates the vessel's core attributes (IMO number, name, vessel type ID, owner, operator) and validation logic, ensuring consistency and correctness within the domain. It includes IMO number validation using the official check-digit algorithm.

- **Persistence**  
  The `IVesselRepository` interface defines methods for saving, updating, and retrieving vessel data. Its implementation manages persistence in the database, including support for searching by IMO number, name, and operator.

- **Validation & Error Handling**  
  Input validation ensures that:
  - IMO numbers follow the official 7-digit format with valid check digit
  - IMO numbers are unique across vessels
  - Referenced vessel types exist in the system
  - All required fields are provided (IMO, name, vessel type)
  - Errors (e.g., invalid IMO, duplicate IMO, non-existing vessel type) trigger appropriate `BusinessRuleValidationException` messages to the user

- **Authorization & Security**  
  Role-based access control ensures that only authenticated users with the "Port Authority Officer" role can register or modify vessel records in the system.

- **Data Consistency**  
  All vessel operations are performed within controlled transactions using `IUnitOfWork.CommitAsync()` to guarantee atomicity. Any failure during validation or persistence results in rollback to maintain database integrity.

---
