<section class="manage-storage-areas">
  <div class="container">
    <h1>{{ t('manageStorageAreas.title') }}</h1>

    <div>
      <h2>{{ t('manageStorageAreas.listTitle') }}</h2>

      <div class="filters-section">
        <h3>{{ t('manageStorageAreas.filters') }}</h3>
        <div class="filter-group">
          <label>{{ t('manageStorageAreas.filterByName') }}</label>
          <input
            type="text"
            [(ngModel)]="filterName"
            name="filterName"
            placeholder="{{ t('manageStorageAreas.filterByNamePlaceholder') }}"
            (keyup.enter)="applyFilter()"
          />
        </div>
        <div class="filter-buttons">
          <button class="primary" (click)="applyFilter()">{{ t('manageStorageAreas.applyFilter') }}</button>
          <button class="secondary" (click)="clearFilter()">{{ t('manageStorageAreas.clearFilter') }}</button>
        </div>
      </div>

      <button (click)="loadStorageAreas()">{{ t('manageStorageAreas.refresh') }}</button>

      <table *ngIf="storageAreas.length > 0">
        <thead>
        <tr>
          <th>{{ t('manageStorageAreas.code') }}</th>
          <th>{{ t('manageStorageAreas.designation') }}</th>
          <th>{{ t('manageStorageAreas.type') }}</th>
          <th>{{ t('manageStorageAreas.location') }}</th>
          <th>{{ t('manageStorageAreas.capacity') }}</th>
          <th>{{ t('manageStorageAreas.dockAssignments') }}</th>
          <th>{{ t('manageStorageAreas.actions') }}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let area of storageAreas">
          <td>{{ area.code }}</td>
          <td>{{ area.designation }}</td>
          <td>{{ area.storageAreaType }}</td>
          <td>{{ area.locationDescription }}</td>
          <td>{{ area.maxCapacityTEUs }}</td>
          <td>
              <span *ngFor="let vt of area.dockAssignments; let last = last">
                {{ vt }}<span *ngIf="!last">, </span>
              </span>
          </td>
          <td>
            <button (click)="editStorageArea(area)">{{ t('manageStorageAreas.edit') }}</button>
            <button class="danger" (click)="softDeleteStorageArea(area.id)">{{ t('manageStorageAreas.delete') }}</button>
          </td>
        </tr>
        </tbody>
      </table>

      <p *ngIf="storageAreas.length === 0">
        {{ t('manageStorageAreas.noStorageAreas') }}
      </p>
    </div>

    <hr />

    <form (ngSubmit)="saveStorageArea()">
      <h2>{{ editing ? t('manageStorageAreas.editTitle') : t('manageStorageAreas.createTitle') }}</h2>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.code') }}</label>
        <input [(ngModel)]="storageForm.code" name="code" placeholder="{{ t('manageStorageAreas.codePlaceholder') }}" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.designation') }}</label>
        <input [(ngModel)]="storageForm.designation" name="designation"
               placeholder="{{ t('manageStorageAreas.designationPlaceholder') }}" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.type') }}</label>
        <select [(ngModel)]="storageForm.storageAreaType" name="storageAreaType" required>
          <option value="Yard">Yard</option>
          <option value="Warehouse">Warehouse</option>
          <option value="Refrigerated">Refrigerated</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.coordinates') }}</label>
        <input
          [(ngModel)]="storageForm.coordinates"
          name="coordinates"
          placeholder="e.g., 41.1786, -8.6080"
          required
        />
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.location') }}</label>
        <input [(ngModel)]="storageForm.locationDescription" name="locationDescription"
               placeholder="{{ t('manageStorageAreas.locationPlaceholder') }}"/>
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.capacity') }}</label>
        <input
          type="number"
          [(ngModel)]="storageForm.maxCapacityTEUs"
          name="maxCapacityTEUs"
          min="1"
          placeholder="{{ t('manageStorageAreas.capacityPlaceholder') }}"
          required
        />
      </div>

      <div class="form-group">
        <label>{{ t('manageStorageAreas.initialDockAssignments') }}</label>
        <div class="dock-checkboxes">
          <div *ngFor="let dock of docks" class="dock-item">
            <input
              type="checkbox"
              [id]="dock.id"
              [(ngModel)]="dockAssignmentsMap[dock.id].assigned"
              (ngModelChange)="onDockAssignmentChange(dock.id, $event)"
              name="dockAssigned_{{ dock.id }}"
            />
            <label [for]="dock.id">{{ dock.name }}</label>

            <input
              type="number"
              placeholder="Distance (m)"
              [disabled]="!dockAssignmentsMap[dock.id].assigned"
              [(ngModel)]="dockAssignmentsMap[dock.id].distance"
              (ngModelChange)="updateDockDistance(dock.id, $event)"
              name="dockDistance_{{ dock.id }}"
              min="0"
              step="0.1"
            />
          </div>
        </div>
      </div>

      <div class="form-buttons">
        <button type="submit">
          {{ editing
          ? t('manageStorageAreas.saveChanges')
          : t('manageStorageAreas.create') }}
        </button>
        <button type="button" class="secondary" (click)="resetForm()">
          {{ t('manageStorageAreas.cancel') }}
        </button>
      </div>
    </form>
  </div>
</section>
