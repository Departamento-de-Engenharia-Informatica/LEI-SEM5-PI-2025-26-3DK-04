<section class="manage-staff-members">
  <div class="container">
    <h1>{{ t('manageStaffMembers.title') }}</h1>

    <div>
      <h2>{{ t('manageStaffMembers.listTitle') }}</h2>
      <button (click)="loadStaffMembers()">{{ t('manageStaffMembers.refresh') }}</button>

      <div class="filters-section">
        <h3>{{ t('manageStaffMembers.filters') }}</h3>
        <div class="filters-grid">
          <div class="filter-group">
            <label>{{ t('manageStaffMembers.filterByName') }}</label>
            <input
              type="text"
              [(ngModel)]="filters.name"
              name="filterName"
              placeholder="{{ t('manageStaffMembers.filterByNamePlaceholder') }}"
              (keyup.enter)="applyFilters()"
            />
          </div>

          <div class="filter-group">
            <label>{{ t('manageStaffMembers.filterByStatus') }}</label>
            <select [(ngModel)]="filters.status" name="filterStatus">
              <option value="">{{ t('manageStaffMembers.allStatuses') }}</option>
              <option value="Available">Available</option>
              <option value="Unavailable">Unavailable</option>
            </select>
          </div>

          <div class="filter-group">
            <label>{{ t('manageStaffMembers.filterByQualification') }}</label>
            <select [(ngModel)]="filters.qualificationId" name="filterQualification">
              <option value="">{{ t('manageStaffMembers.allQualifications') }}</option>
              <option *ngFor="let qual of qualifications" [value]="qual.id">{{ qual.name }}</option>
            </select>
          </div>
        </div>

        <div class="filter-buttons">
          <button class="primary" (click)="applyFilters()">{{ t('manageStaffMembers.applyFilters') }}</button>
          <button class="secondary" (click)="clearFilters()">{{ t('manageStaffMembers.clearFilters') }}</button>
        </div>
      </div>

      <table *ngIf="staffMembers.length > 0">
        <thead>
        <tr>
          <th>{{ t('manageStaffMembers.name') }}</th>
          <th>{{ t('manageStaffMembers.email') }}</th>
          <th>{{ t('manageStaffMembers.phone') }}</th>
          <th>{{ t('manageStaffMembers.operationalWindow') }}</th>
          <th>{{ t('manageStaffMembers.status') }}</th>
          <th>{{ t('manageStaffMembers.qualifications') }}</th>
          <th>{{ t('manageStaffMembers.actions') }}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let staff of staffMembers">
          <td>{{ staff.name }}</td>
          <td>{{ staff.email }}</td>
          <td>{{ staff.phoneNumber }}</td>
          <td>{{ staff.operationalWindow.startTime }} - {{ staff.operationalWindow.endTime }}</td>
          <td>
            <span [class]="getStatusClass(staff.status)">{{ staff.status }}</span>
          </td>
          <td>
            <span *ngIf="staff.qualifications && staff.qualifications.length > 0">
              <span *ngFor="let q of staff.qualifications; let last = last">
                {{ q.name }}<span *ngIf="!last">, </span>
              </span>
            </span>
            <span *ngIf="!staff.qualifications || staff.qualifications.length === 0" class="no-data">
              No qualifications
            </span>
          </td>
          <td>
            <button (click)="editStaffMember(staff)">{{ t('manageStaffMembers.edit') }}</button>
            <button *ngIf="staff.status === 'Available'" class="warning" (click)="deactivateStaffMember(staff.id)">
              {{ t('manageStaffMembers.deactivate') }}
            </button>
            <button *ngIf="staff.status === 'Unavailable'" class="success" (click)="reactivateStaffMember(staff.id)">
              {{ t('manageStaffMembers.reactivate') }}
            </button>
          </td>
        </tr>
        </tbody>
      </table>

      <p *ngIf="staffMembers.length === 0">
        {{ t('manageStaffMembers.noStaffMembers') }}
      </p>
    </div>

    <hr />

    <form (ngSubmit)="saveStaffMember()">
      <h2>{{ editing ? t('manageStaffMembers.editTitle') : t('manageStaffMembers.createTitle') }}</h2>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.name') }}</label>
        <input [(ngModel)]="staffForm.name" name="name" placeholder="{{ t('manageStaffMembers.namePlaceholder') }}" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.email') }}</label>
        <input type="email" [(ngModel)]="staffForm.email" name="email"
               placeholder="{{ t('manageStaffMembers.emailPlaceholder') }}" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.phone') }}</label>
        <input type="number" [(ngModel)]="staffForm.phoneNumber" name="phoneNumber"
               placeholder="{{ t('manageStaffMembers.phonePlaceholder') }}" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.startTime') }}</label>
        <input type="time" [(ngModel)]="staffForm.startTime" name="startTime"
               placeholder="HH:mm" required />
      </div>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.endTime') }}</label>
        <input type="time" [(ngModel)]="staffForm.endTime" name="endTime"
               placeholder="HH:mm" required />
      </div>

      <div class="form-group" *ngIf="editing">
        <label>{{ t('manageStaffMembers.status') }}</label>
        <select [(ngModel)]="staffForm.status" name="status">
          <option value="Available">Available</option>
          <option value="Unavailable">Unavailable</option>
        </select>
      </div>

      <div class="form-group">
        <label>{{ t('manageStaffMembers.qualifications') }}</label>
        <div class="qualifications-checkboxes" *ngIf="qualifications.length > 0">
          <div *ngFor="let qual of qualifications" class="qualification-item">
            <input
              type="checkbox"
              [id]="qual.id"
              [value]="qual.id"
              (change)="onQualificationChange(qual.id, $event)"
              [checked]="isQualificationAssigned(qual.id)"
            />
            <label [for]="qual.id">{{ qual.name }}</label>
          </div>
        </div>
        <p *ngIf="qualifications.length === 0" class="no-data">
          {{ t('manageStaffMembers.noQualifications') }}
        </p>
      </div>

      <div class="form-buttons">
        <button type="submit">
          {{ editing
          ? t('manageStaffMembers.saveChanges')
          : t('manageStaffMembers.create') }}
        </button>
        <button type="button" class="secondary" (click)="resetForm()">
          {{ t('manageStaffMembers.cancel') }}
        </button>
      </div>
    </form>
  </div>
</section>
